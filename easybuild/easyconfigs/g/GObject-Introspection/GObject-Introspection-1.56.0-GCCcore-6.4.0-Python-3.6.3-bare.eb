easyblock = 'ConfigureMake'

name = 'GObject-Introspection'
version = '1.56.0'
pyver = '3.6.3'
pyshortver = '3.6'
pysubver = '-bare'
versionsuffix = '-Python-%s%s' % (pyver, pysubver)

homepage = 'https://wiki.gnome.org/GObjectIntrospection/'

description = """
 GObject introspection is a middleware layer between C libraries (using GObject)
 and language bindings. The C library can be scanned at compile time and generate
 a metadata file, in addition to the actual native C library. Then at runtime,
 language bindings can read this metadata and automatically provide bindings
 to call into the C library.
"""

toolchain = {'name': 'GCCcore', 'version': '6.4.0'}

source_urls = [FTPGNOME_SOURCE]
sources = [SOURCELOWER_TAR_XZ]
checksums = ['0d7059fad7aa5ec50d9678aea4ea139acab23737e9cf9ca0d86c615cecbaa0f8']

builddependencies = [
    ('Autotools', '20170619'),
    ('binutils', '2.28'),
    ('Bison', '3.0.4'),
    ('cairo', '1.15.10', versionsuffix),
    ('flex', '2.6.4'),
    ('Python', pyver, pysubver),
]

dependencies = [
    ('GLib', '2.56.0', versionsuffix),
    ('libffi', '3.2.1'),
]

preconfigopts = """
    export GI_SCANNER_DISABLE_CACHE=true
    export PYTHON=python3.6m
"""

# avoid using hard-coded path to 'python' in shebang of scripts
buildopts = "PYTHON=python"

modextrapaths = {
    'GI_TYPELIB_PATH': 'share',
    'XDG_DATA_DIRS': 'share',
}

sanity_check_paths = {
    'files': ['bin/g-ir-%s' % x for x in ['annotation-tool', 'compiler', 'generate', 'scanner']] +
             ['lib/libgirepository-1.0.%s' % x for x in [SHLIB_EXT, 'a']],
    'dirs': ['include', 'share']
}

moduleclass = 'devel'
