easyblock = 'CmdCp'

name = 'VisIt'
version = '2.7.3'
visitver= '2_7_3'
python = "Python"
pythonversion = '2.7.6'
versionsuffix = "-%s-%s" % (python, pythonversion)
build_visit = "build_visit%s" % visitver

homepage = 'https://wci.llnl.gov/simulation/computer-codes/visit'
description = """VisIt is an Open Source, interactive, scalable, visualization, animation and analysis tool."""

toolchain = {'name': 'ictce', 'version': '6.3.5'}
toolchainopts = {'openmp': True}

# http://portal.nersc.gov/svn/visit/trunk/releases/2.7.3/build_visit2_7_3
source_urls = ['http://portal.nersc.gov/svn/visit/trunk/releases/%(version)s/']
#sources = ['build_visit2_7_3']
sources = [build_visit]

dependencies = [
                (python, pythonversion),
                ('Boost', '1.55.0', versionsuffix ),
                ('CMake', '3.0.0'),
                ('Qt', '4.8.6')
               ]

skipsteps = ['source']

# '-j' fixed at 8 since there was no easy way to access 'parallel' with CmdCp easyblock (and there is no "EB_EC_PARAM_MAXPARALLEL" yet)
# leaving it unbounded is a bad idea... leaving it at 1 is unecessarily slow 
cmds_map = [('build_visit2_7_3', 'PYTHON_LIBRARIES=$EBROOTPYTHON/lib PYTHON_INCLUDE_PATH=$EBROOTPYTHON/include %(source)s --prefix `pwd`/installdir --makeflags "-j 8" --console --parallel --no-thirdparty --system-cmake --system-python --system-qt --cc $CC --cxx $CXX --vtk')]

files_to_copy = [(['installdir/*'], '.'),
                 (['build_visit2_7_3_log'], 'easybuild'),]

sanity_check_paths = {
    'files': ['bin/visit'],
    'dirs': ['bin',version],
}

moduleclass = 'vis'

# EOF
